namespace SpriteKind {
    export const Target = SpriteKind.create()
    export const Text = SpriteKind.create()
}
namespace StatusBarKind {
    export const Fuel = StatusBarKind.create()
    export const Speed = StatusBarKind.create()
    export const Altitude = StatusBarKind.create()
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile2, function (sprite, location) {
    if (isPlaying) {
        if (falcon.vy > crashSpeed) {
            story.queueStoryPart(function () {
                animation.runImageAnimation(
                falcon,
                [img`
                    ................................
                    ................................
                    ................fff.............
                    ...............ff1ff............
                    ...............f1f1f............
                    ...............ff1ff............
                    ...............f1f1f............
                    ............ffff111ffff.........
                    ..............ff111ff...........
                    ...............f111f............
                    ...............f111f............
                    ...............f111f............
                    ...............ff1ff............
                    ...............f1f1f............
                    ...............f111f............
                    ...............f111f............
                    ...............f111f............
                    ...............f111f............
                    ...............f111f............
                    ...............ff1ff............
                    ...............fbfbf............
                    ...............f54bf............
                    ...............f454f............
                    ..............4f455f4...........
                    .............44fb5bf5...........
                    .............45fb1b554..........
                    .............455b1b554..........
                    .............555b1bf54..........
                    ..............fff55ff...........
                    ..............f45554ff..........
                    .............f..4f5..f..........
                    ...........ff...f....fff........
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ........................fff.....
                    ...................f...ff11f....
                    ...................ff.ff1f1f....
                    ....................ffff11ff....
                    .....................f1ffff.....
                    ....................ff111f......
                    ....................f111fff.....
                    ...................ff111f.ff....
                    ...................f1f1ff..f....
                    ..................ff11ff........
                    ..................f111ff........
                    .................ff111f.........
                    .................f111ff.........
                    ................ff111f..........
                    ................f111ff..........
                    ...............fff144...........
                    ...............4444f4444........
                    ..............445b554444........
                    .............4455bf5444.........
                    ............45f51b5544..........
                    ............45551b5544..........
                    ............55522bf54...........
                    .............fff52ff............
                    ...........fff45554fff..........
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    .........................fff....
                    ....................f...ff11f...
                    .....................f.ff1f1f...
                    ......................f1f11ff...
                    .....................f11ffff....
                    ....................f1111f......
                    ...................f1111f.......
                    ..................f1111f.f......
                    .................f1f11f...f.....
                    ..............44f144ff..........
                    .............4444441f...........
                    ............44445444............
                    ............44244554............
                    ...........44522444444..........
                    ...........4454245544...........
                    ..........445544454544..........
                    ..........455222455444..........
                    .........442552544544...........
                    ..........4422552554............
                    ...........44454444.............
                    ...........fff52ff..............
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................4.........f.....
                    ...........444..4.........f.....
                    ..........44.4..4........ff.....
                    ..........4444544ffffffffffffff.
                    ..........44455544111f111111f1ff
                    .........44445454111f111111f1f1f
                    .........444545441111f111111f1ff
                    ........44444445441ffffffffffff.
                    ........44454225444......ff.....
                    ........4544222554444.....f.....
                    .........45455245444......f.....
                    .......444f454244544............
                    .......44454552444444...........
                    ......444442452445544...........
                    ......4444ff22444544............
                    .......444455444444.............
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    .....................4.4........
                    .....................4444.......
                    ..................44.444444.....
                    ................4444445544......
                    ...............44445451f1f......
                    .............444444544f111f...f.
                    ...........4444444454.4f111fff..
                    .........445444545444.44f111f...
                    ........45444525554444...f111f..
                    .........555554545444....ff1f1f.
                    .......4544422222444.....f.f1f1f
                    .......45544254244444...f...f1ff
                    ......444442245244444........ff.
                    ......44455555544444............
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ..............4....4............
                    ..................444..4........
                    ...............4..4545444.......
                    .............44.44454444444.....
                    ............44444445444544......
                    ...........44454444444441f......
                    ...........44454454444f411f...f.
                    ...........4555444444444111fff4.
                    ..........44454455444444f111f4..
                    .........44444424444.....f111f.4
                    .........442245244444....ff1f1f4
                    ........455555544444.....f.f1f44
                    .......445455444444.....f..441f.
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ..........44....................
                    .........444.44........4..f.....
                    .......44444444...44..4444f....4
                    ......4444444444.4444444444.4.44
                    ......4444bf54444fffff5544ff444.
                    .....444f55ff4444411555111114444
                    ......f45554f4444111f111111f1f14
                    .....fff4f52544111111f111111f144
                    ...ff4f5f4425f44fffffffffffff444
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ...........................4....
                    ....................4......4....
                    ...........................4....
                    ................4............4..
                    .....4...44......4..............
                    ....44..444...4.....44.444f.4...
                    ....44444b44444...44.44444f44..4
                    ....44441bf544...444444444444.44
                    ....55fb1bf54...4ff44f455444444.
                    .....fff55ff44.44414554225114544
                    .....f45554f44444111f122551f1554
                    ....f..4f5..444111111f111111f154
                    ..ff...f....f4f4fffffffffffff444
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ..........444..........4.....4..
                    ......4...........44..44...4.44.
                    ......4.......4....4......44..44
                    .....4..44....44...4............
                    ....44444b4444444....44444f444..
                    ...4444444f544...44444444444444.
                    ....55f44bf54...4ff44f445444444.
                    .....fff55ff44.44444554525114544
                    .....f45554f44442221f122551f1554
                    ....f..4f5..444111111f111111f154
                    ..ff...f....f4f4fffffffffffff444
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ...........................4....
                    ....................4......4....
                    ...........................4....
                    ................4............4..
                    .....4...44......4..............
                    ....44..444...4.....44.444f.4...
                    ....44444b44444...44.44444f44..4
                    ....44441bf544...444444444444.44
                    ....55fb1bf54...4ff44f455444444.
                    .....fff55ff44.44414554225114544
                    .....f45554f44444111f122551f1554
                    ....f..4f5..444111111f111111f154
                    ..ff...f....f4f4fffffffffffff444
                    `,img`
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ................................
                    ..........444..........4.....4..
                    ......4...........44..44...4.44.
                    ......4.......4....4......44..44
                    .....4..44....44...4............
                    ....44444b4444444....44444f444..
                    ...4444444f544...44444444444444.
                    ....55f44bf54...4ff44f445444444.
                    .....fff55ff44.44444554525114544
                    .....f45554f44442221f122551f1554
                    ....f..4f5..444111111f111111f154
                    ..ff...f....f4f4fffffffffffff444
                    `],
                200,
                false
                )
                pause(2000)
                game.over(false)
            })
        } else {
            fromCentre = Math.abs(landingView.x - target.x)
            scorePenalty = 130 - fromCentre * 10
            info.setScore(fuelLevel.value * scorePenalty)
            game.over(true)
        }
    }
    falcon.setVelocity(0, 0)
    isPlaying = false
})
scene.onOverlapTile(SpriteKind.Player, myTiles.tile4, function (sprite, location) {
    if (isPlaying) {
        story.queueStoryPart(function () {
            animation.runImageAnimation(
            falcon,
            [img`
                ................................
                ................................
                ................fff.............
                ...............ff1ff............
                ...............f1f1f............
                ...............ff1ff............
                ...............f1f1f............
                ............ffff111ffff.........
                ..............ff111ff...........
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............ff1ff............
                ...............f1f1f............
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............ff1ff............
                ...............fbfbf............
                ...............f54bf............
                ...............f454f............
                ..............4f455f4...........
                .............44fb5bf5...........
                .............45fb1b554..........
                .............455b1b554..........
                .............555b1bf54..........
                .........8....fff55ff.8.........
                .........88ff.f45554ff88........
                ........8888.f..4f5..f88........
                .......888888...f...88888.......
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ........................fff.....
                ...................f...ff11f....
                ...................ff.ff1f1f....
                ....................ffff11ff....
                .....................f1ffff.....
                ....................ff111f......
                ....................f111fff.....
                ...................ff111f.ff....
                ...................f1f1ff..f....
                ..................ff11ff........
                ..................f111ff........
                .................ff111f.........
                .................f111ff.........
                ................ff111f..........
                ................f111ff..........
                ...............fff144...........
                ...............4444f4444........
                ..............445b554444........
                .........8...4455bf5444.........
                .........88.45f51b5544..........
                .......8....45551b5544.8........
                .......88...55522bf54..8.8......
                ........8....fff52ff.8888.......
                ........88ff.f45554ff8888.......
                .......8888.f..4f5..f888........
                ..........88...f...8888.........
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .........................fff....
                ....................f...ff11f...
                .....................f.ff1f1f...
                ......................f1f11ff...
                .....................f11ffff....
                ....................f1111f......
                ...................f1111f.......
                ..................f1111f.f......
                .................f1f11f...f.....
                ..............44f144ff..........
                .............4444441f...........
                ............44445444............
                ............44244554............
                ...........44522444444..........
                ...........4454245544...........
                .........4845542454544..........
                ..........455222455444..........
                .........442552548544...........
                ......8...4222552554............
                ......8..888445444488.88........
                .....88888.fff52ff.8888.........
                ....8888ff.f45554ff88888........
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................4.........f.....
                ...........444..4.........f.....
                ..........44.4..4........ff.....
                ..........4444544ffffffffffffff.
                ..........44455544111f111111f1ff
                .........44445454111f111111f1f1f
                .........444545441111f111111f1ff
                ........44444445441ffffffffffff.
                ........44454225444......ff.....
                ....8...4544222554444.8...f.....
                .........45455245444......f.....
                .......444f454244544............
                ....8..44454552444444..8........
                ......444442452445544...........
                ......4444ff22444544............
                .....88444455444444.8...........
                ......8.444444444888............
                .......8888884448888............
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .....................4.4........
                .....................4444.......
                ..................44.444444.....
                ................4444445544......
                ...............44445451f1f......
                .............444444544f111f.....
                ...........4444444454.4f111f....
                .........445444545444.44f111f...
                ........45444525554444...f111f..
                .........555554545444.....f1f1f.
                .......4544422222444.......f1f1f
                .......45544254244444.......f1ff
                ......444442245244444........ff.
                .....844455555544444............
                ......84454554444448............
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ...................4............
                ..................444..4........
                ...............4..4545444.......
                .............44.44454444444.....
                ............44444445444544......
                ...........44454444444441f......
                ..........844454454444f411f.....
                ...........4555444444444111f....
                ......8...44454455444444f111f..8
                .....8...444444244448....f111f.8
                .........442245244444.....f1f1f8
                .....8..455555544444.....88f1f18
                ......84454554444448......888818
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .......................4..f...88
                .............88...44..4444f...8.
                ..............88.4444448444.....
                ................4fffff5544fffff.
                ...............4441155511111f1ff
                ...............44111f111111f1f18
                ..............4888111f111111f188
                .............44488888ffff8888888
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .......................4..f.....
                ..................44..4444f.4.4.
                .................444444444444444
                ................44f4ffff44fffff4
                ...............444111f111111f1ff
                ...............44111f111111f1f1f
                ..............4441111f111111f1ff
                `],
            200,
            false
            )
            pause(1800)
            falcon.destroy(effects.bubbles, 500)
            pause(1000)
            game.over(false)
        })
    }
    falcon.setVelocity(0, 0)
    isPlaying = false
})
function gameUpdate () {
    target.x = Math.map(falcon.x, 0, 256, scene.screenWidth() - landingView.width, scene.screenWidth())
    currentAltitude.value = scene.cameraProperty(CameraProperty.Y)
    lowSpeed.value = Math.ceil(falcon.vy)
    highSpeed.value = Math.ceil(falcon.vy) - crashSpeed
    falcon.vx = Math.constrain(controller.acceleration(ControllerDimension.X), -50, 50)
    if (controller.A.isPressed() && fuelLevel.value > 0) {
        falcon.setImage(img`
            ......fff......
            .....ff1ff.....
            .....f1f1f.....
            .....ff1ff.....
            .....f1f1f.....
            ..ffff111ffff..
            ....ff111ff....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....f1f1f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....fbfbf.....
            .....fbbbf.....
            .....fbbbf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            ....fff1fff....
            ....f4fff4f....
            ...f442f254f...
            ..ff545f445ff..
            .ff..54f45..ff.
            ff....5f5....ff
            `)
        falcon.ay = -200
        fuelLevel.value += -1
    } else {
        falcon.setImage(img`
            ......fff......
            .....ff1ff.....
            .....f1f1f.....
            .....ff1ff.....
            .....f1f1f.....
            ..ffff111ffff..
            ....ff111ff....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....f1f1f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....fbfbf.....
            .....fbbbf.....
            .....fbbbf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            ....fff1fff....
            ....f4fff4f....
            ...ff.4f4.ff...
            ..ff...f...ff..
            .ff....f....ff.
            ff.....f.....ff
            `)
        falcon.ay = 100
    }
}
let scorePenalty = 0
let fromCentre = 0
let currentAltitude: StatusBarSprite = null
let highSpeed: StatusBarSprite = null
let lowSpeed: StatusBarSprite = null
let fuelLevel: StatusBarSprite = null
let target: Sprite = null
let landingView: Sprite = null
let falcon: Sprite = null
let isPlaying = false
let crashSpeed = 0
crashSpeed = 200
isPlaying = false
tiles.setTilemap(tilemap`level`)
falcon = sprites.create(img`
    ......fff......
    .....ff1ff.....
    .....f1f1f.....
    .....ff1ff.....
    .....f1f1f.....
    ..ffff111ffff..
    ....ff111ff....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....ff1ff.....
    .....f1f1f.....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....ff1ff.....
    .....fbfbf.....
    .....fbbbf.....
    .....fbbbf.....
    .....fb1bf.....
    .....fb1bf.....
    .....fb1bf.....
    .....fb1bf.....
    .....fb1bf.....
    ....fff1fff....
    ....f4fff4f....
    ...ff.4f4.ff...
    ..ff...f...ff..
    .ff....f....ff.
    ff.....f.....ff
    `, SpriteKind.Player)
scene.cameraFollowSprite(falcon)
landingView = sprites.create(img`
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbb111bbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbb1b1b1bbbbbbbbb8888888888888888888f
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    f88888888888888888888bbbbbbbbb1b1b1bbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbb111bbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    `, SpriteKind.Player)
landingView.setFlag(SpriteFlag.RelativeToCamera, true)
landingView.right = scene.screenWidth()
landingView.bottom = scene.screenHeight()
target = sprites.create(img`
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    `, SpriteKind.Target)
target.setFlag(SpriteFlag.RelativeToCamera, true)
target.setPosition(landingView.x, landingView.y)
fuelLevel = statusbars.create(6, 100, StatusBarKind.Fuel)
fuelLevel.setBarBorder(1, 15)
fuelLevel.left = 3
fuelLevel.setLabel("F", 13)
lowSpeed = statusbars.create(6, 40, StatusBarKind.Speed)
lowSpeed.setBarBorder(1, 15)
lowSpeed.left = 12
lowSpeed.bottom = fuelLevel.bottom
lowSpeed.max = crashSpeed
lowSpeed.setColor(7, 15)
highSpeed = statusbars.create(6, 60, StatusBarKind.Speed)
highSpeed.setBarBorder(1, 15)
highSpeed.left = 12
highSpeed.top = fuelLevel.top
highSpeed.max = 500 - crashSpeed
highSpeed.setColor(2, 15)
highSpeed.setLabel("S", 13)
currentAltitude = statusbars.create(6, 100, StatusBarKind.Altitude)
currentAltitude.setBarBorder(1, 15)
currentAltitude.left = 21
currentAltitude.setColor(15, 11)
currentAltitude.max = 1988
currentAltitude.setStatusBarFlag(StatusBarFlag.InvertFillDirection, true)
currentAltitude.setLabel("A", 13)
gameUpdate()
game.splash("Falcon X", "Tilt to move. A to boost.")
isPlaying = true
game.onUpdateInterval(100, function () {
    if (isPlaying) {
        gameUpdate()
    }
})
