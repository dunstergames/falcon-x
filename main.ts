namespace SpriteKind {
    export const Target = SpriteKind.create()
    export const Text = SpriteKind.create()
}
namespace StatusBarKind {
    export const Fuel = StatusBarKind.create()
    export const Speed = StatusBarKind.create()
    export const Altitude = StatusBarKind.create()
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile2, function (sprite, location) {
    if (isPlaying) {
        if (falcon.vy > crashSpeed) {
            story.queueStoryPart(function () {
                animation.runImageAnimation(
                falcon,
                [img`
                    ......fff......
                    .....ff1ff.....
                    .....f1f1f.....
                    .....ff1ff.....
                    .....f1f1f.....
                    ..ffff111ffff..
                    ....ff111ff....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....ff1ff.....
                    .....f1f1f.....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....ff1ff.....
                    .....fbfbf.....
                    .....f54bf.....
                    .....f454f.....
                    ....4f455f4....
                    ...44fb5bf5....
                    ...45fb1b554...
                    ...455b1b554...
                    ...555b1bf54...
                    ....fff55ff....
                    ....f45554f....
                    ...f..4f5..f...
                    ..ff...f...ff..
                    .ff....f....ff.
                    ff.....f.....ff
                    `,img`
                    ......fff......
                    .....ff1ff.....
                    .....f1f1f.....
                    .....ff1ff.....
                    .....f1f1f.....
                    ..ffff111ffff..
                    ....ff111ff....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....ff1ff.....
                    .....f1f1f.....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....f111f.....
                    .....ff1ff.....
                    .....44444.....
                    ....4454b44....
                    ....4f454f44...
                    ....45555f544..
                    ...45522bf554..
                    ...45f5225554..
                    ...45551b5554..
                    ..445555b5554..
                    ...444f554444..
                    ....f445555....
                    ...f..5f555f...
                    ..ff...f...ff..
                    .ff....f....ff.
                    ff.....f.....ff
                    `,img`
                    ......fff......
                    .....ff1ff.....
                    .....f1f1f.....
                    .....ff1ff.....
                    .....f1f1f.....
                    ..ffff111ffff..
                    ....ff111ff....
                    .....f111f.....
                    .....f1554.....
                    .....f4414.....
                    .....f42f4.....
                    .....f44244....
                    .....4442f4....
                    .....4555f4....
                    ....441222.4...
                    ...4445222444..
                    ...4455225444..
                    ...445f225444..
                    ..44554225554..
                    ..445552225544.
                    ..445542225544.
                    ...455552f544..
                    ...44522bf555..
                    ...54f5225554..
                    ...45551b5554..
                    ..445555b5554..
                    ...444f554444..
                    ...44445555....
                    ...4.44f445f...
                    ..ff...44..ff..
                    .ff....f....ff.
                    ff.....f.....ff
                    `,img`
                    ......fff......
                    .....ff1ff.....
                    .....f1f1f.....
                    .....ff44f.....
                    .....f1f44.....
                    ..ffff1444fff..
                    ....ff4454f....
                    .....441144....
                    .....455554....
                    .....4441544...
                    ....4442f5.4...
                    ....4f445554...
                    ....44455f5.4..
                    ..4444555f554..
                    ..45441522.544.
                    .4444455224544.
                    .4544552524544.
                    .4554555522544.
                    .4555542552544.
                    .4545552522544.
                    .4545542525554.
                    .45455555225544
                    .4554522bf255.4
                    .4454f5225255.4
                    ..455551b525454
                    ..455555b525454
                    ..4454f55555444
                    ..444445555.44.
                    ...4.44f445f45.
                    ..ff...44.555..
                    .ff....f....ff.
                    ff.....f.....ff
                    `,img`
                    ....44555......
                    ....4fff45.....
                    ...4ff4444.....
                    ...45544455....
                    ...4554fff55...
                    ..5555424ff55..
                    ..55552445f.5..
                    ..45525445fff..
                    .445ff4425555..
                    .45ff44425455..
                    .44f24442225...
                    .4f5245555555..
                    44522424225.55.
                    45225424255545.
                    4.25552255.545.
                    442255422555554
                    445255425225544
                    455552245425544
                    455552244425224
                    455455224225424
                    455555424455224
                    455525525455254
                    4555425244255.4
                    4545424244255.4
                    454525524525554
                    445555424525554
                    455554224552544
                    454554444552244
                    .55245544442544
                    .54245544.5555.
                    .4444445555544.
                    445554444444.45
                    `,img`
                    ...............
                    ...............
                    ...............
                    .......44......
                    .......f4......
                    .......444.....
                    ......4454.....
                    .....445544....
                    .....455554....
                    .....4455544...
                    ....44525444...
                    ....4f524454...
                    ....44425f5.4..
                    ..4444552f554..
                    ..45441522.544.
                    .4444455224544.
                    .4544552524544.
                    .4554555522544.
                    .4555542552544.
                    .4545552522544.
                    .4545542525554.
                    .45455555225544
                    .4554522bf245.4
                    .4454f5225445.4
                    ..455451b445554
                    ..454445b445454
                    .44545442544554
                    ..5544542544554
                    .45554442244454
                    .44455444224544
                    .4445555545554.
                    ..444445555444.
                    `,img`
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ......44.......
                    ......4244.....
                    ......44444....
                    .....444444....
                    .....455544....
                    ....444244.4...
                    ...4445242444..
                    ...4455225444..
                    ...4454255444..
                    ..44454255544..
                    ..444545525444.
                    ..444545225544.
                    ...4454424544..
                    ...44522445544.
                    ...44454445544.
                    ...45442555544.
                    ..44445245554..
                    ...4455444444..
                    ...4455455544..
                    ...4444444444..
                    .....444444....
                    `,img`
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ......44.......
                    ......444......
                    .....4424......
                    .....44245.....
                    .....44244.....
                    ....444554.....
                    ....4545245....
                    ....4544244....
                    ....4522444....
                    ....4454444....
                    ....44425544...
                    ....445245544..
                    ...4445444444..
                    ....44445554...
                    .....444444....
                    .......444.....
                    `,img`
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ...............
                    ..........5....
                    ......4.2......
                    ........4......
                    ......544......
                    .......25......
                    .....4..4......
                    ......5........
                    ....444........
                    .....44.4......
                    .......44......
                    `],
                200,
                false
                )
                pause(1800)
                falcon.destroy(effects.fire, 200)
                pause(1000)
                game.over(false)
            })
        } else {
            fromCentre = Math.abs(landingView.x - target.x)
            scorePenalty = 130 - fromCentre * 10
            info.setScore(fuelLevel.value * scorePenalty)
            game.over(true)
        }
    }
    falcon.setVelocity(0, 0)
    isPlaying = false
})
scene.onOverlapTile(SpriteKind.Player, myTiles.tile4, function (sprite, location) {
    if (isPlaying) {
        story.queueStoryPart(function () {
            animation.runImageAnimation(
            falcon,
            [img`
                ................................
                ................................
                ................fff.............
                ...............ff1ff............
                ...............f1f1f............
                ...............ff1ff............
                ...............f1f1f............
                ............ffff111ffff.........
                ..............ff111ff...........
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............ff1ff............
                ...............f1f1f............
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............f111f............
                ...............ff1ff............
                ...............fbfbf............
                ...............f54bf............
                ...............f454f............
                ..............4f455f4...........
                .............44fb5bf5...........
                .............45fb1b554..........
                .............455b1b554..........
                .............555b1bf54..........
                .........8....fff55ff.8.........
                .........88ff.f45554ff88........
                ........8888.f..4f5..f88........
                .......888888...f...88888.......
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ........................fff.....
                ...................f...ff11f....
                ...................ff.ff1f1f....
                ....................ffff11ff....
                .....................f1ffff.....
                ....................ff111f......
                ....................f111fff.....
                ...................ff111f.ff....
                ...................f1f1ff..f....
                ..................ff11ff........
                ..................f111ff........
                .................ff111f.........
                .................f111ff.........
                ................ff111f..........
                ................f111ff..........
                ...............fff144...........
                ...............4444f4444........
                ..............445b554444........
                .........8...4455bf5444.........
                .........88.45f51b5544..........
                .......8....45551b5544.8........
                .......88...55522bf54..8.8......
                ........8....fff52ff.8888.......
                ........88ff.f45554ff8888.......
                .......8888.f..4f5..f888........
                ..........88...f...8888.........
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .........................fff....
                ....................f...ff11f...
                .....................f.ff1f1f...
                ......................f1f11ff...
                .....................f11ffff....
                ....................f1111f......
                ...................f1111f.......
                ..................f1111f.f......
                .................f1f11f...f.....
                ..............44f144ff..........
                .............4444441f...........
                ............44445444............
                ............44244554............
                ...........44522444444..........
                ...........4454245544...........
                .........4845542454544..........
                ..........455222455444..........
                .........442552548544...........
                ......8...4222552554............
                ......8..888445444488.88........
                .....88888.fff52ff.8888.........
                ....8888ff.f45554ff88888........
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................4.........f.....
                ...........444..4.........f.....
                ..........44.4..4........ff.....
                ..........4444544ffffffffffffff.
                ..........44455544111f111111f1ff
                .........44445454111f111111f1f1f
                .........444545441111f111111f1ff
                ........44444445441ffffffffffff.
                ........44454225444......ff.....
                ....8...4544222554444.8...f.....
                .........45455245444......f.....
                .......444f454244544............
                ....8..44454552444444..8........
                ......444442452445544...........
                ......4444ff22444544............
                .....88444455444444.8...........
                ......8.444444444888............
                .......8888884448888............
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .....................4.4........
                .....................4444.......
                ..................44.444444.....
                ................4444445544......
                ...............44445451f1f......
                .............444444544f111f.....
                ...........4444444454.4f111f....
                .........445444545444.44f111f...
                ........45444525554444...f111f..
                .........555554545444.....f1f1f.
                .......4544422222444.......f1f1f
                .......45544254244444.......f1ff
                ......444442245244444........ff.
                .....844455555544444............
                ......84454554444448............
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ...................4............
                ..................444..4........
                ...............4..4545444.......
                .............44.44454444444.....
                ............44444445444544......
                ...........44454444444441f......
                ..........844454454444f411f.....
                ...........4555444444444111f....
                ......8...44454455444444f111f..8
                .....8...444444244448....f111f.8
                .........442245244444.....f1f1f8
                .....8..455555544444.....88f1f18
                ......84454554444448......888818
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .......................4..f...88
                .............88...44..4444f...8.
                ..............88.4444448444.....
                ................4fffff5544fffff.
                ...............4441155511111f1ff
                ...............44111f111111f1f18
                ..............4888111f111111f188
                .............44488888ffff8888888
                `,img`
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                ................................
                .......................4..f.....
                ..................44..4444f.4.4.
                .................444444444444444
                ................44f4ffff44fffff4
                ...............444111f111111f1ff
                ...............44111f111111f1f1f
                ..............4441111f111111f1ff
                `],
            200,
            false
            )
            pause(1800)
            falcon.destroy(effects.bubbles, 200)
            pause(1000)
            game.over(false)
        })
    }
    falcon.setVelocity(0, 0)
    isPlaying = false
})
function gameUpdate () {
    target.x = Math.map(falcon.x, 0, 256, scene.screenWidth() - landingView.width, scene.screenWidth())
    currentAltitude.value = scene.cameraProperty(CameraProperty.Y)
    lowSpeed.value = Math.ceil(falcon.vy)
    highSpeed.value = Math.ceil(falcon.vy) - crashSpeed
    falcon.vx = Math.constrain(controller.acceleration(ControllerDimension.X), -50, 50)
    if (controller.A.isPressed() && fuelLevel.value > 0) {
        falcon.setImage(img`
            ......fff......
            .....ff1ff.....
            .....f1f1f.....
            .....ff1ff.....
            .....f1f1f.....
            ..ffff111ffff..
            ....ff111ff....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....f1f1f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....fbfbf.....
            .....fbbbf.....
            .....fbbbf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            ....fff1fff....
            ....f4fff4f....
            ...f442f254f...
            ..ff545f445ff..
            .ff..54f45..ff.
            ff....5f5....ff
            `)
        falcon.ay = -200
        fuelLevel.value += -1
    } else {
        falcon.setImage(img`
            ......fff......
            .....ff1ff.....
            .....f1f1f.....
            .....ff1ff.....
            .....f1f1f.....
            ..ffff111ffff..
            ....ff111ff....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....f1f1f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....f111f.....
            .....ff1ff.....
            .....fbfbf.....
            .....fbbbf.....
            .....fbbbf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            .....fb1bf.....
            ....fff1fff....
            ....f4fff4f....
            ...ff.4f4.ff...
            ..ff...f...ff..
            .ff....f....ff.
            ff.....f.....ff
            `)
        falcon.ay = 100
    }
}
let scorePenalty = 0
let fromCentre = 0
let currentAltitude: StatusBarSprite = null
let highSpeed: StatusBarSprite = null
let lowSpeed: StatusBarSprite = null
let fuelLevel: StatusBarSprite = null
let target: Sprite = null
let landingView: Sprite = null
let falcon: Sprite = null
let isPlaying = false
let crashSpeed = 0
crashSpeed = 200
isPlaying = false
tiles.setTilemap(tilemap`level`)
falcon = sprites.create(img`
    ......fff......
    .....ff1ff.....
    .....f1f1f.....
    .....ff1ff.....
    .....f1f1f.....
    ..ffff111ffff..
    ....ff111ff....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....ff1ff.....
    .....f1f1f.....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....f111f.....
    .....ff1ff.....
    .....fbfbf.....
    .....fbbbf.....
    .....fbbbf.....
    .....fb1bf.....
    .....fb1bf.....
    .....fb1bf.....
    .....fb1bf.....
    .....fb1bf.....
    ....fff1fff....
    ....f4fff4f....
    ...ff.4f4.ff...
    ..ff...f...ff..
    .ff....f....ff.
    ff.....f.....ff
    `, SpriteKind.Player)
scene.cameraFollowSprite(falcon)
landingView = sprites.create(img`
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbb111bbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbb1b1b1bbbbbbbbb8888888888888888888f
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    f88888888888888888888bbbbbbbbb1b1b1bbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbb111bbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    `, SpriteKind.Player)
landingView.setFlag(SpriteFlag.RelativeToCamera, true)
landingView.right = scene.screenWidth()
landingView.bottom = scene.screenHeight()
target = sprites.create(img`
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    `, SpriteKind.Target)
target.setFlag(SpriteFlag.RelativeToCamera, true)
target.setPosition(landingView.x, landingView.y)
fuelLevel = statusbars.create(6, 100, StatusBarKind.Fuel)
fuelLevel.setBarBorder(1, 15)
fuelLevel.left = 3
fuelLevel.setLabel("F", 13)
lowSpeed = statusbars.create(6, 40, StatusBarKind.Speed)
lowSpeed.setBarBorder(1, 15)
lowSpeed.left = 12
lowSpeed.bottom = fuelLevel.bottom
lowSpeed.max = crashSpeed
lowSpeed.setColor(7, 15)
highSpeed = statusbars.create(6, 60, StatusBarKind.Speed)
highSpeed.setBarBorder(1, 15)
highSpeed.left = 12
highSpeed.top = fuelLevel.top
highSpeed.max = 500 - crashSpeed
highSpeed.setColor(2, 15)
highSpeed.setLabel("S", 13)
currentAltitude = statusbars.create(6, 100, StatusBarKind.Altitude)
currentAltitude.setBarBorder(1, 15)
currentAltitude.left = 21
currentAltitude.setColor(15, 11)
currentAltitude.max = 1988
currentAltitude.setStatusBarFlag(StatusBarFlag.InvertFillDirection, true)
currentAltitude.setLabel("A", 13)
gameUpdate()
game.splash("Falcon X", "Tilt to move. A to boost.")
isPlaying = true
game.onUpdateInterval(100, function () {
    if (isPlaying) {
        gameUpdate()
    }
})
