namespace SpriteKind {
    export const Target = SpriteKind.create()
}
namespace StatusBarKind {
    export const Fuel = StatusBarKind.create()
    export const Speed = StatusBarKind.create()
    export const Altitude = StatusBarKind.create()
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile2, function (sprite, location) {
    if (falcon.vy > crashSpeed) {
        game.over(false)
    } else {
        fromCentre = Math.abs(landingView.x - target.x)
        scorePenalty = 130 - fromCentre * 10
        info.setScore(fuelLevel.value * scorePenalty)
        game.over(true)
    }
})
scene.onOverlapTile(SpriteKind.Player, myTiles.tile4, function (sprite, location) {
    game.over(false)
})
let scorePenalty = 0
let fromCentre = 0
let fuelLevel: StatusBarSprite = null
let target: Sprite = null
let landingView: Sprite = null
let falcon: Sprite = null
let crashSpeed = 0
crashSpeed = 200
tiles.setTilemap(tiles.createTilemap(hex`100080000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030303030302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030303030302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030303030302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202030303030303030303030303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030303020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203030303030303030303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030303020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203030303030303030303030303020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020303030303030303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203030303030303030303030303020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202030303030303030303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202030303030303030303030303030302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203030303030303030303030302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203030303030303030303030302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202040404040404020202020205050505050505050505050505050505`, img`
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    ................
    `, [myTiles.transparency16,sprites.dungeon.darkGroundCenter,myTiles.tile1,myTiles.tile3,myTiles.tile2,myTiles.tile4], TileScale.Sixteen))
falcon = sprites.create(img`
    . . . . . . . f . . . . . . . . 
    . . . . . . f 1 f . . . . . . . 
    . . . . . f 1 1 1 f . . . . . . 
    . . . . . f 1 f 1 f . . . . . . 
    . . . . . f 1 1 1 f . . . . . . 
    . . . . . f 1 1 1 f . . . . . . 
    . . . . . f f 1 f f . . . . . . 
    . . . . . f 1 f 1 f . . . . . . 
    . . . . . f 1 1 1 f . . . . . . 
    . . . . . f 1 1 1 f . . . . . . 
    . . . . . f f 1 f f . . . . . . 
    . . . . . f 1 f 1 f . . . . . . 
    . . . . . f 1 1 1 f . . . . . . 
    . . . . f 4 f f f 4 f . . . . . 
    . . . f . . 4 f 4 . . f . . . . 
    . . f . . . . f . . . . f . . . 
    `, SpriteKind.Player)
scene.cameraFollowSprite(falcon)
landingView = sprites.create(img`
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbb111bbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbb1b1b1bbbbbbbbb8888888888888888888f
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    f88888888888888888888bbbbbbbbb1b1b1bbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbb111bbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888bbbbbbbbbbb1bbbbbbbbbbb8888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    f88888888888888888888888888888888888888888888888888888888888888f
    ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
    `, SpriteKind.Player)
landingView.setFlag(SpriteFlag.RelativeToCamera, true)
landingView.right = scene.screenWidth()
landingView.bottom = scene.screenHeight()
target = sprites.create(img`
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    . . . . f . . . . 
    `, SpriteKind.Target)
target.setFlag(SpriteFlag.RelativeToCamera, true)
target.setPosition(landingView.x, landingView.y)
fuelLevel = statusbars.create(6, 100, StatusBarKind.Fuel)
fuelLevel.setBarBorder(1, 15)
fuelLevel.left = 3
let lowSpeed = statusbars.create(6, 40, StatusBarKind.Speed)
lowSpeed.setBarBorder(1, 15)
lowSpeed.left = 12
lowSpeed.bottom = fuelLevel.bottom
lowSpeed.max = crashSpeed
lowSpeed.setColor(7, 15)
let highSpeed = statusbars.create(6, 60, StatusBarKind.Speed)
highSpeed.setBarBorder(1, 15)
highSpeed.left = 12
highSpeed.bottom = lowSpeed.top
highSpeed.max = 500 - crashSpeed
highSpeed.setColor(2, 15)
let currentAltitude = statusbars.create(6, 100, StatusBarKind.Altitude)
currentAltitude.setBarBorder(1, 15)
currentAltitude.left = 20
currentAltitude.setColor(15, 11)
currentAltitude.max = 1988
currentAltitude.setStatusBarFlag(StatusBarFlag.InvertFillDirection, true)
game.onUpdateInterval(100, function () {
    target.x = Math.map(falcon.x, 0, 256, scene.screenWidth() - landingView.width, scene.screenWidth())
    currentAltitude.value = scene.cameraProperty(CameraProperty.Y)
    lowSpeed.value = Math.ceil(falcon.vy)
    highSpeed.value = Math.ceil(falcon.vy) - crashSpeed
    falcon.vx = Math.constrain(controller.acceleration(ControllerDimension.X), -50, 50)
    if (controller.A.isPressed() && fuelLevel.value > 0) {
        falcon.ay = -200
        fuelLevel.value += -1
    } else {
        falcon.ay = 100
    }
})
